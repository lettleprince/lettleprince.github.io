---
layout: post
title: "区块链学习笔记(二)——比特币如何实现去中心化"
description: ""
category: articles
tags: [BlockChain]
comments: true
---


## 2.1 Centralization vs. Decentralization

去中心化不代表“什么都没有”。

比特币的去中心化可以分解成以下五个问题：

1. 谁来维护账本？

2. 谁能够验证交易的合法性？

3. 谁创造新币？

4. 谁决定系统的变化规则？

5. 比特币如何实现交易价值？

主要注意：

在比特币协议之上，可以存在交易所，钱包，服务商等具有中心化性质的事物。

比特币的设计：

- 点对点网络 (Peer-to-peer network)。

- 采矿 (Mining)。虽然每个人都能进行，但实际目前来讲采矿的成本已经很高，使得比特币具有一些中心化。

- 软件更新。比特币系统的代码是开源的，开发者也都由社区信任。当然，这也有一定程度上的中心化。

## 2.2 分布式一致性 (Distributed Consensus)

比特币的关键技术挑战之一为：分布式一致性 (Distributed Consensus)，或分布式共识。

分布式共识协议两个属性：

- 协议中止时，所有正确节点都要承认结果 value。

- 结果 value 由某一正确的节点产生。

例如：Alice 对 Bob 的支付，实际上是 Alice 向点对点网络中发出广播，声明此次支付。即便 Bob 没有在网络中，或者暂时没有在线，也不影响支付的有效性。

比特币系统中，在任意时刻：

- 网络中的所有节点拥有一系列已达成共识的区块账本。

- 每个节点用一堆没有被打包进区块的交易（这些交易已经发生并广播），此时每个节点所接收到的交易并不完全一致。

每隔一段时间之后，每个节点会把自己接收到的交易产生为区块作为输入，让其他节点来达成共识。这个共识很难完成，无法保证其他节点的可信任性。当然这个区块并不一定需要包含当前所有交易，未包含的交易可以在下一区块进行打包。

问题是，存在恶意节点以及不完美网络的情况下，如何达成一致。

传统上有 `Byzantine generals problem` 和 `Fischer-Lynch Paterson` 理论（系统中只要有一个损坏节点便不可能达成共识），并且著名的 Paxos 协议能避免产生不一致的结果，但是有时协议会死机卡住无法运行。

比特币运行的比理论要好得多。同时理论也很重要，可以预防可能的问题和攻击。

比特币的不同之处：

- 奖励机制（这可能因为比特币是一种货币的原因）。

- 包含随机性。

比特币不纠结于共识的起点和终点。而是通过较长的时间完成——一个小时左右。实际上是随着时间越久，确定的概率越大。

## 2.3 无需身份的共识 —— 区块链

身份机制在 p2p 网络中是不安全的，同时，匿名制 (Pseudonymity) 也是比特币的目标之一。

弱假设：

在系统中可以随机选择一个节点。这个理论稍后证明。


#### 隐性共识 (implicit consensus)

简化的共识算法：

1. 新交易被广播给所有节点。

2. 每个节点都监听网络并将监听到的交易放进区块。

3. 每一轮都会随机选中某个节点，将它的区块广播给其他节点。

4. 其他节点只有在验证交易有效（加密签名过）后才会接受区块。

5. 节点会通过把受到的区块的哈希值放进其产生的下一个区块中，来表示对此区块的认可。

Alice 被随机选中，可以广播自己产生的区块，于是她想发起攻击：

- Steal Coin

Alice 想要盗取比特币，根据 PayCoins 的原则，也就是需要创造一个交易，来消耗掉比特币，同时要被币的所有者签名表示认同。而只要签名机制是良好的，就无法实现这个攻击。

- Denial of Service

Alice 想要攻击 Bob，故意不把跟 Bob 相关的交易放进区块。这并不是问题，因为其他的节点在之后发起区块时，Bob 的交易会被写入。

- Double-spending attack

Alice 用比特币购买 Bob 的商品，Alice 广播交易之后，交易被诚实节点监听到，写入到区块中，并广播出来。

这个区块包含有 Alice 的签名，支付币给 Bob 公钥地址的信息和一个哈希值。这个哈希值指向这个币之前的一笔交易记录。

![Decentralization-01](https://lettleprince.github.io/images/20180120-decentralization/01.png)

注意，两种哈希指针的概念：

一种哈希指针是指向前一個随机选中的节点提出的区块，形成区块链；

另一种哈希指针是指，区块中的多条交易记录，每条记录都包含哈希指针指向此币的前一笔交易。

至此，Bob 会认为交易完成。但如果下次随即被选中的节点正好是 Alice 的节点，那她不仅可以忽略掉这个区块，还可以产生包含新交易的区块，这个交易的包含指向前一笔交易的哈希指针和支付给 A'（这个地址其实也是 Alice 的）的信息，产生了双重支付攻击。

![Decentralization-02](https://lettleprince.github.io/images/20180120-decentralization/02.png)

此时将有两个区块，哪一个区块被达成共识将决定于谁被纳入长期共识链（long-term consensus block chain）。

所有的诚实节点都只会延长最长的有效分支链。

这两条分支链在技术上都是有效的。实践中，节点通常是延长最先监听到的区块。但由于延迟或其他原因，是有可能选择包含双重支付的分支链进行延长的。这样，Bob 的支付便会失效。

从 Bob 来看这笔交易，他可以选择等待，在几个回合之后，如果包含此交易的区块被纳入了长期共识链，那他再确认收到比特币。在这种情况下，双重支付需要恶意节点连续被选中才能成功。

![Decentralization-03](https://lettleprince.github.io/images/20180120-decentralization/03.png)

双重支付的成功率随着确认的数目的增加而指数级变小。一般认为 6 个确认之后，可以认为已经被纳入长期共识链。

密码学可以防止不正当交易，而双重支付的预防完全依靠的是绝大多数节点都诚实的情况下的共识。

## 2.4 奖励机制（incentive）和工作量证明（proof of work）










